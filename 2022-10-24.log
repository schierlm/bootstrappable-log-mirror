<!DOCTYPE html><html><head><title>IRC channel logs</title><style>html {
  background: #fdfdfd;
}

h1 {
  font-weight: 300;
}

h2 {
  font-weight: 200;
}

h3 {
  padding: .5em 0;
  border-top: 3px dotted #ddd;
  margin-bottom: 0;
}

form {
  width: 400px;
  display: flex;
}

input {
  width: 100%;
  display: flex;
  border-radius: .25em 0 0 .25em;
  border: 1px solid #aaa;
  border-right: 0;
  padding: 0.5em;
}

button {
  display: flex;
  border-radius: 0 .25em .25em 0;
  background-color: #007bff;
  border: 1px solid #007bff;
  padding: .5em;
  cursor: pointer;
  color: white;
}

button:hover {
  background-color: #0069d9;
  border-color: #0062cc;
}

a {
  color: #007bff;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h4 {
  margin-bottom: .5em;
}

table td {
  padding: 0.75em;
}

table tr:hover {
  background: #eee;
}

.year {
  display: table;
}

.month {
  display: table-cell;
  padding-right: 1em;
}

ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

.nick {
  padding-right: 0.6rem;
  font-weight: bold;
  text-align: right;
  width: 13rem;
  display: table-cell;
}

.nick a {
  color: inherit;
  text-decoration: none;
}

.message {
  display: table-cell;
  padding-left: 0.6rem;
  border-left: 2px solid #333;
}

.notice {
  color: #859900;
  font-style: italic;
}

.line {
  line-height: 1.8rem;
  display: table;
}

#logs {
  margin-top: 1.5rem;
  padding: 1.5rem;
}
</style></head><body><h1>IRC channel logs</h1><h2>2022-10-24.log</h2><p><a href="/bootstrappable">back to list of logs</a></p><div id="logs"><div class="line" id="080801"><span class="nick">***</span><span class="message notice">tanvirroshid9 is now known as tanvirroshid</span></div><div class="line" id="200336"><span class="nick" style="color:#8dd3c7"><a href="#200336" label="[20:03:36]">&lt;rekado_&gt;</a></span><span class="message">getting closer to building a ghc 4 with debug symbols.</span></div><div class="line" id="200420"><span class="nick" style="color:#8dd3c7"><a href="#200420" label="[20:04:20]">&lt;rekado_&gt;</a></span><span class="message">they do everything manually; the perl script “ghc-asm.prl” strips the generated binaries, and they use bfd to provide custom debug symbols.</span></div><div class="line" id="200511"><span class="nick" style="color:#8dd3c7"><a href="#200511" label="[20:05:11]">&lt;rekado_&gt;</a></span><span class="message">all this custom futzing around with the binaries means that I can’t deviate much from the tools of that era</span></div><div class="line" id="200537"><span class="nick" style="color:#8dd3c7"><a href="#200537" label="[20:05:37]">&lt;rekado_&gt;</a></span><span class="message">it must be a pretty old binutils and gcc, but old binutils doesn’t work well with a more recent libc.</span></div><div class="line" id="202939"><span class="nick" style="color:#8dd3c7"><a href="#202939" label="[20:29:39]">&lt;rekado_&gt;</a></span><span class="message">I’ve built the compiler now, but gdb doesn’t seem to do anything with the DEBUG_LoadSymbols definition</span></div><div class="line" id="203029"><span class="nick" style="color:#8dd3c7"><a href="#203029" label="[20:30:29]">&lt;rekado_&gt;</a></span><span class="message">do any of you know how to make use of a definition of “extern void DEBUG_LoadSymbols” when using gdb?</span></div><div class="line" id="203424"><span class="nick" style="color:#8dd3c7"><a href="#203424" label="[20:34:24]">&lt;rekado_&gt;</a></span><span class="message">(maybe this is just GHC-specific and nobody else does this kind of thing)</span></div><div class="line" id="214357"><span class="nick" style="color:#2e2a4a"><a href="#214357" label="[21:43:57]">&lt;stikonas&gt;</a></span><span class="message">I'm not really GDB expert but soudns like it mightb e GHC specific</span></div><div class="line" id="214555"><span class="nick" style="color:#2e2a4a"><a href="#214555" label="[21:45:55]">&lt;stikonas&gt;</a></span><span class="message">at least that is in ghc source <a rel="nofollow" href="https://github.com/ghc/ghc/blob/master/rts/RtsStartup.c#L318">https://github.com/ghc/ghc/blob/master/rts/RtsStartup.c#L318</a> </span></div><div class="line" id="215206"><span class="nick" style="color:#8dd3c7"><a href="#215206" label="[21:52:06]">&lt;rekado_&gt;</a></span><span class="message">stikonas: thanks for the hint!</span></div><div class="line" id="215221"><span class="nick" style="color:#8dd3c7"><a href="#215221" label="[21:52:21]">&lt;rekado_&gt;</a></span><span class="message">ghc 4 doesn’t do that, so it’s good to see an example of how this is intended to be used.</span></div><div class="line" id="220136"><span class="nick" style="color:#2e2a4a"><a href="#220136" label="[22:01:36]">&lt;stikonas&gt;</a></span><span class="message">I guess that's the latest...</span></div><div class="line" id="232941"><span class="nick" style="color:#2e2a4a"><a href="#232941" label="[23:29:41]">&lt;stikonas&gt;</a></span><span class="message">\me is trying to investigate some very strange UEFI M2libc bug...</span></div><div class="line" id="233026"><span class="nick" style="color:#2e2a4a"><a href="#233026" label="[23:30:26]">&lt;stikonas&gt;</a></span><span class="message">(looks like I used wrong slash for IRC *nick thing)</span></div><div class="line" id="233244"><span class="nick" style="color:#2e2a4a"><a href="#233244" label="[23:32:44]">&lt;stikonas&gt;</a></span><span class="message">some strange interaction between writing to file (fputc or fclose), _free_pages(_malloc_start, PAGE_NUM) function call and repeated running of my small test program (first run seems to work)</span></div><div class="line" id="233419"><span class="nick" style="color:#2e2a4a"><a href="#233419" label="[23:34:19]">&lt;stikonas&gt;</a></span><span class="message">and even stranger, re-running BOOTX64 to rebuild everything seems to mitigate the problem, it only gets stuck if I repeatedly run the same things twice</span></div><div class="line" id="233431"><span class="nick" style="color:#6b8072"><a href="#233431" label="[23:34:31]">&lt;muurkha&gt;</a></span><span class="message">good thing it wasn't \m hotbabe32 sure, my number is +1 730 555 1212</span></div><div class="line" id="233519"><span class="nick" style="color:#2e2a4a"><a href="#233519" label="[23:35:19]">&lt;stikonas&gt;</a></span><span class="message">I guess some kind of memory issue, but still symptoms are very strange...</span></div><div class="line" id="233526"><span class="nick" style="color:#6b8072"><a href="#233526" label="[23:35:26]">&lt;muurkha&gt;</a></span><span class="message">it does sound very strange</span></div><div class="line" id="234056"><span class="nick" style="color:#2e2a4a"><a href="#234056" label="[23:40:56]">&lt;stikonas&gt;</a></span><span class="message">well, hence my suspicion that there is some bad memory handling, those bugs tend to be weird</span></div><div class="line" id="234802"><span class="nick" style="color:#80b1d3"><a href="#234802" label="[23:48:02]">&lt;oriansj&gt;</a></span><span class="message">stikonas: well we do buffer writes and if they aren't flushed it could result in truncated write results</span></div><div class="line" id="234823"><span class="nick" style="color:#80b1d3"><a href="#234823" label="[23:48:23]">&lt;oriansj&gt;</a></span><span class="message">(we also buffer reads by just reading the whole file at once)</span></div><div class="line" id="235211"><span class="nick" style="color:#80b1d3"><a href="#235211" label="[23:52:11]">&lt;oriansj&gt;</a></span><span class="message">muurkha: only on the internet can one pause and wonder if hotbabe32 is 32 or if he was born in  1932 or if she's an 11 year old FBI agent.</span></div><div class="line" id="235225"><span class="nick" style="color:#2e2a4a"><a href="#235225" label="[23:52:25]">&lt;stikonas&gt;</a></span><span class="message">oriansj: that's still bootstrap.c so I don't think there are buffer writes</span></div><div class="line" id="235252"><span class="nick" style="color:#2e2a4a"><a href="#235252" label="[23:52:52]">&lt;stikonas&gt;</a></span><span class="message">so no bufferring yet</span></div><div class="line" id="235309"><span class="nick" style="color:#80b1d3"><a href="#235309" label="[23:53:09]">&lt;oriansj&gt;</a></span><span class="message">hmmm too many writes occuring?</span></div><div class="line" id="235443"><span class="nick" style="color:#2e2a4a"><a href="#235443" label="[23:54:43]">&lt;stikonas&gt;</a></span><span class="message">hmm, unlikely, let me show my test program</span></div><div class="line" id="235502"><span class="nick" style="color:#2e2a4a"><a href="#235502" label="[23:55:02]">&lt;stikonas&gt;</a></span><span class="message"> <a rel="nofollow" href="https://paste.debian.net/1258157/">https://paste.debian.net/1258157/</a> </span></div><div class="line" id="235506"><span class="nick" style="color:#2e2a4a"><a href="#235506" label="[23:55:06]">&lt;stikonas&gt;</a></span><span class="message">very few writes...</span></div><div class="line" id="235554"><span class="nick" style="color:#2e2a4a"><a href="#235554" label="[23:55:54]">&lt;stikonas&gt;</a></span><span class="message">and if I put exit(5); before fputc('\n', f); then it exits just fine and I can run it repeatedly (that's probably expected)</span></div><div class="line" id="235622"><span class="nick" style="color:#80b1d3"><a href="#235622" label="[23:56:22]">&lt;oriansj&gt;</a></span><span class="message">well UEFI probably needs the \r as well</span></div><div class="line" id="235628"><span class="nick" style="color:#2e2a4a"><a href="#235628" label="[23:56:28]">&lt;stikonas&gt;</a></span><span class="message">but the stranger thing is that I can run the program witout exit (the one that can't be rerun without getting stuck)</span></div><div class="line" id="235643"><span class="nick" style="color:#2e2a4a"><a href="#235643" label="[23:56:43]">&lt;stikonas&gt;</a></span><span class="message">then the one with exit, then I can run the one without exit and it would work then</span></div><div class="line" id="235653"><span class="nick" style="color:#2e2a4a"><a href="#235653" label="[23:56:53]">&lt;stikonas&gt;</a></span><span class="message">oriansj: that is handled at bootstrap.c level</span></div><div class="line" id="235700"><span class="nick" style="color:#2e2a4a"><a href="#235700" label="[23:57:00]">&lt;stikonas&gt;</a></span><span class="message">let me show that as well</span></div><div class="line" id="235726"><span class="nick" style="color:#2e2a4a"><a href="#235726" label="[23:57:26]">&lt;stikonas&gt;</a></span><span class="message">it's still very much wip but better than nothing</span></div><div class="line" id="235746"><span class="nick" style="color:#2e2a4a"><a href="#235746" label="[23:57:46]">&lt;stikonas&gt;</a></span><span class="message">hmm, let me just push to a branch...</span></div><div class="line" id="235750"><span class="nick" style="color:#2e2a4a"><a href="#235750" label="[23:57:50]">&lt;stikonas&gt;</a></span><span class="message">pastebin is not that convenient</span></div><div class="line" id="235905"><span class="nick" style="color:#80b1d3"><a href="#235905" label="[23:59:05]">&lt;oriansj&gt;</a></span><span class="message">(pastebinit kinda is though...)</span></div><div class="line" id="235925"><span class="nick" style="color:#2e2a4a"><a href="#235925" label="[23:59:25]">&lt;stikonas&gt;</a></span><span class="message">ok, I can paste it too</span></div><br /></div></body></html>