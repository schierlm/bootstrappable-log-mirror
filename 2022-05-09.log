<!DOCTYPE html><html><head><title>IRC channel logs</title><style>html {
  background: #fdfdfd;
}

h1 {
  font-weight: 300;
}

h2 {
  font-weight: 200;
}

h3 {
  padding: .5em 0;
  border-top: 3px dotted #ddd;
  margin-bottom: 0;
}

form {
  width: 400px;
  display: flex;
}

input {
  width: 100%;
  display: flex;
  border-radius: .25em 0 0 .25em;
  border: 1px solid #aaa;
  border-right: 0;
  padding: 0.5em;
}

button {
  display: flex;
  border-radius: 0 .25em .25em 0;
  background-color: #007bff;
  border: 1px solid #007bff;
  padding: .5em;
  cursor: pointer;
  color: white;
}

button:hover {
  background-color: #0069d9;
  border-color: #0062cc;
}

a {
  color: #007bff;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

h4 {
  margin-bottom: .5em;
}

table td {
  padding: 0.75em;
}

table tr:hover {
  background: #eee;
}

.year {
  display: table;
}

.month {
  display: table-cell;
  padding-right: 1em;
}

ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

.nick {
  padding-right: 0.6rem;
  font-weight: bold;
  text-align: right;
  width: 13rem;
  display: table-cell;
}

.nick a {
  color: inherit;
  text-decoration: none;
}

.message {
  display: table-cell;
  padding-left: 0.6rem;
  border-left: 2px solid #333;
}

.notice {
  color: #859900;
  font-style: italic;
}

.line {
  line-height: 1.8rem;
  display: table;
}

#logs {
  margin-top: 1.5rem;
  padding: 1.5rem;
}
</style></head><body><h1>IRC channel logs</h1><h2>2022-05-09.log</h2><p><a href="/bootstrappable">back to list of logs</a></p><div id="logs"><div class="line" id="000442"><span class="nick" style="color:#389600"><a href="#000442" label="[00:04:42]">&lt;stikonas&gt;</a></span><span class="message">oh yes, you need to either init or update submodules</span></div><div class="line" id="000453"><span class="nick" style="color:#389600"><a href="#000453" label="[00:04:53]">&lt;stikonas&gt;</a></span><span class="message">I think it's in readme</span></div><div class="line" id="000459"><span class="nick" style="color:#389600"><a href="#000459" label="[00:04:59]">&lt;stikonas&gt;</a></span><span class="message">but easy to forget since it's one off step</span></div><div class="line" id="000503"><span class="nick" style="color:#389600"><a href="#000503" label="[00:05:03]">&lt;stikonas&gt;</a></span><span class="message">or mostly one off</span></div><div class="line" id="001758"><span class="nick" style="color:#2e2a4a"><a href="#001758" label="[00:17:58]">&lt;doras&gt;</a></span><span class="message">I did, but I think it somehow kept the previous checkout I had or something.</span></div><div class="line" id="001809"><span class="nick" style="color:#2e2a4a"><a href="#001809" label="[00:18:09]">&lt;doras&gt;</a></span><span class="message">So apparently mes is missing my fix:</span></div><div class="line" id="001809"><span class="nick" style="color:#2e2a4a"><a href="#001809" label="[00:18:09]">&lt;doras&gt;</a></span><span class="message"> <a rel="nofollow" href="http://git.savannah.gnu.org/cgit/mes.git/tree/include/sys/stat.h#n110">http://git.savannah.gnu.org/cgit/mes.git/tree/include/sys/stat.h#n110</a> </span></div><div class="line" id="001916"><span class="nick" style="color:#2e2a4a"><a href="#001916" label="[00:19:16]">&lt;doras&gt;</a></span><span class="message">I was sure janneke took it when we talked about it at the time.</span></div><div class="line" id="001934"><span class="nick" style="color:#6b8072"><a href="#001934" label="[00:19:34]">*</a></span><span class="message">doras sighs</span></div><div class="line" id="002208"><span class="nick" style="color:#2e2a4a"><a href="#002208" label="[00:22:08]">&lt;doras&gt;</a></span><span class="message">janneke: a 0 is missing: <a rel="nofollow" href="https://github.com/oriansj/mes-m2/commit/dad1744fa80f52b3b428803c06b09d39c285f500">https://github.com/oriansj/mes-m2/commit/dad1744fa80f52b3b428803c06b09d39c285f500</a> </span></div><div class="line" id="002552"><span class="nick" style="color:#2e2a4a"><a href="#002552" label="[00:25:52]">&lt;doras&gt;</a></span><span class="message">I can't find any documentation about how to contribute patches to the mes project.</span></div><div class="line" id="003013"><span class="nick" style="color:#2e2a4a"><a href="#003013" label="[00:30:13]">&lt;doras&gt;</a></span><span class="message">I guess you can simply &quot;git am&quot; this, it seems to work: <a rel="nofollow" href="https://github.com/oriansj/mes-m2/commit/dad1744fa80f52b3b428803c06b09d39c285f500.patch">https://github.com/oriansj/mes-m2/commit/dad1744fa80f52b3b428803c06b09d39c285f500.patch</a> </span></div><div class="line" id="003303"><span class="nick" style="color:#389600"><a href="#003303" label="[00:33:03]">&lt;stikonas&gt;</a></span><span class="message">yes, I thought you sent it to upstream mes too</span></div><div class="line" id="003306"><span class="nick" style="color:#389600"><a href="#003306" label="[00:33:06]">&lt;stikonas&gt;</a></span><span class="message">but I guess it got lost</span></div><div class="line" id="003324"><span class="nick" style="color:#389600"><a href="#003324" label="[00:33:24]">&lt;stikonas&gt;</a></span><span class="message">doras: what was the problem without that patch?</span></div><div class="line" id="003404"><span class="nick" style="color:#2e2a4a"><a href="#003404" label="[00:34:04]">&lt;doras&gt;</a></span><span class="message">Basically file permissions are messed up.</span></div><div class="line" id="003432"><span class="nick" style="color:#2e2a4a"><a href="#003432" label="[00:34:32]">&lt;doras&gt;</a></span><span class="message">I don't remember the exact effect, but permissions are confused in some way.</span></div><div class="line" id="003522"><span class="nick" style="color:#2e2a4a"><a href="#003522" label="[00:35:22]">&lt;doras&gt;</a></span><span class="message">I'm not sure if it's related (yet), but I now see that &quot;cp&quot; from mes seems to remove the owner read permission.</span></div><div class="line" id="005726"><span class="nick" style="color:#2e2a4a"><a href="#005726" label="[00:57:26]">&lt;doras&gt;</a></span><span class="message">I submitted the patch to bug-mes@gnu.org. Hopefully it's the right place.</span></div><div class="line" id="005838"><span class="nick" style="color:#2e2a4a"><a href="#005838" label="[00:58:38]">&lt;doras&gt;</a></span><span class="message">Yeah, the bug basically it made S_ISUID == S_IRUSR.</span></div><div class="line" id="005927"><span class="nick" style="color:#2e2a4a"><a href="#005927" label="[00:59:27]">&lt;doras&gt;</a></span><span class="message">So if SUID is removed through some mask, it actually also removed the owner read permission.</span></div><div class="line" id="010019"><span class="nick" style="color:#2e2a4a"><a href="#010019" label="[01:00:19]">&lt;doras&gt;</a></span><span class="message">Similarly, if using &quot;ls&quot;, all files with the owner read bit enabled also appear to have the SUID bit enabled.</span></div><div class="line" id="010037"><span class="nick" style="color:#2e2a4a"><a href="#010037" label="[01:00:37]">&lt;doras&gt;</a></span><span class="message">made it*</span></div><div class="line" id="010215"><span class="nick" style="color:#2e2a4a"><a href="#010215" label="[01:02:15]">&lt;doras&gt;</a></span><span class="message">The root user doesn't seem to care about read permissions, so it isn't affected. Once you a non-root user, you start getting failures in basic operations.</span></div><div class="line" id="010329"><span class="nick" style="color:#2e2a4a"><a href="#010329" label="[01:03:29]">&lt;doras&gt;</a></span><span class="message">I think I'll wait for mes upstream to pick up the patch and tag a release, and for live-bootstrap to update to it.</span></div><div class="line" id="010720"><span class="nick" style="color:#389600"><a href="#010720" label="[01:07:20]">&lt;stikonas&gt;</a></span><span class="message">well, at least mes upstream is now the only mes</span></div><div class="line" id="010729"><span class="nick" style="color:#389600"><a href="#010729" label="[01:07:29]">&lt;stikonas&gt;</a></span><span class="message">mes-m2 is no longer necessary</span></div><div class="line" id="011007"><span class="nick" style="color:#389600"><a href="#011007" label="[01:10:07]">&lt;stikonas&gt;</a></span><span class="message">and hopefully mes 0.25 will come much quicker than the time it took for 0.24 release</span></div><div class="line" id="011327"><span class="nick" style="color:#389600"><a href="#011327" label="[01:13:27]">&lt;stikonas&gt;</a></span><span class="message">and janneke seems to be very busy incorporating improvements from M2-Planet 1.10.0</span></div><div class="line" id="011409"><span class="nick" style="color:#389600"><a href="#011409" label="[01:14:09]">&lt;stikonas&gt;</a></span><span class="message">I can see plenty of nice improvements since 0.24</span></div><div class="line" id="012856"><span class="nick" style="color:#2e2a4a"><a href="#012856" label="[01:28:56]">&lt;doras&gt;</a></span><span class="message">Maybe I'll rebase my branch temporarily to the commit before the removal of mes-m2. Just to be able to proceed.</span></div><div class="line" id="012915"><span class="nick" style="color:#80b1d3"><a href="#012915" label="[01:29:15]">&lt;stikonas[m]&gt;</a></span><span class="message">Yes, makes sense</span></div><div class="line" id="105224"><span class="nick" style="color:#2e2a4a"><a href="#105224" label="[10:52:24]">&lt;doras&gt;</a></span><span class="message">I seem to be getting wrong hashes with both the chroot and bwrap modes, but in different ways.</span></div><div class="line" id="105328"><span class="nick" style="color:#2e2a4a"><a href="#105328" label="[10:53:28]">&lt;doras&gt;</a></span><span class="message">The only change I have locally for the chroot mode is that I'm not using tmpfs with it either. Basically the commit above, but with conflicts resolved.</span></div><div class="line" id="105353"><span class="nick" style="color:#2e2a4a"><a href="#105353" label="[10:53:53]">&lt;doras&gt;</a></span><span class="message">Well, the commit I mentioned previously*</span></div><div class="line" id="105440"><span class="nick" style="color:#2e2a4a"><a href="#105440" label="[10:54:40]">&lt;doras&gt;</a></span><span class="message">This one: <a rel="nofollow" href="https://github.com/doraskayo/live-bootstrap/commit/b16e0d1a9eff767e5e27064d86293a0aad66d9bb">https://github.com/doraskayo/live-bootstrap/commit/b16e0d1a9eff767e5e27064d86293a0aad66d9bb</a> </span></div><div class="line" id="105634"><span class="nick" style="color:#2e2a4a"><a href="#105634" label="[10:56:34]">&lt;doras&gt;</a></span><span class="message">I don't have time to look into at the moment, but it does look like something regressed somewhere.</span></div><div class="line" id="105734"><span class="nick" style="color:#2e2a4a"><a href="#105734" label="[10:57:34]">&lt;doras&gt;</a></span><span class="message">This is without the last MR that switched away from mes-m2.</span></div><div class="line" id="112323"><span class="nick" style="color:#80b1d3"><a href="#112323" label="[11:23:23]">&lt;stikonas[m]&gt;</a></span><span class="message">doras: oh, tmpfs fixes might be after mes-m2 to mes change, you need to pull it into your branch</span></div><div class="line" id="112350"><span class="nick" style="color:#80b1d3"><a href="#112350" label="[11:23:50]">&lt;stikonas[m]&gt;</a></span><span class="message"> <a rel="nofollow" href="https://github.com/fosslinux/live-bootstrap/commit/c189dad1684755bf8f6e18069df454836a656dc0">https://github.com/fosslinux/live-bootstrap/commit/c189dad1684755bf8f6e18069df454836a656dc0</a> </span></div><div class="line" id="163433"><span class="nick" style="color:#2e2a4a"><a href="#163433" label="[16:34:33]">&lt;doras&gt;</a></span><span class="message">stikonas @stikonas:kde.org: I think I had this one applied. The move to mes is the very last commit in the master branch, and I only excluded this one.</span></div><div class="line" id="163510"><span class="nick" style="color:#389600"><a href="#163510" label="[16:35:10]">&lt;stikonas&gt;</a></span><span class="message">maybe there are more issues then</span></div><div class="line" id="163533"><span class="nick" style="color:#389600"><a href="#163533" label="[16:35:33]">&lt;stikonas&gt;</a></span><span class="message">hmm</span></div><div class="line" id="163559"><span class="nick" style="color:#389600"><a href="#163559" label="[16:35:59]">&lt;stikonas&gt;</a></span><span class="message">doras: anyway, you can try to use mes snapshot rather than 0.24 now that janneke accepted your patch</span></div><div class="line" id="164324"><span class="nick" style="color:#6d2462"><a href="#164324" label="[16:43:24]">&lt;janneke&gt;</a></span><span class="message">doras: yeah, sorry for taking so long!</span></div><div class="line" id="165223"><span class="nick" style="color:#2e2a4a"><a href="#165223" label="[16:52:23]">&lt;doras&gt;</a></span><span class="message">No problem :)</span></div><div class="line" id="165338"><span class="nick" style="color:#2e2a4a"><a href="#165338" label="[16:53:38]">&lt;doras&gt;</a></span><span class="message">stikonas: I think I can't do that until I can trust the hashes I get. The change in mes will definitely change some of them, and I need to be able to distinguish changes that are due to an issue and changes that are due to mes fixing the SUID issue.</span></div><div class="line" id="165413"><span class="nick" style="color:#2e2a4a"><a href="#165413" label="[16:54:13]">&lt;doras&gt;</a></span><span class="message">How come we didn't have the tmpfs-related issues before?</span></div><div class="line" id="165503"><span class="nick" style="color:#389600"><a href="#165503" label="[16:55:03]">&lt;stikonas&gt;</a></span><span class="message">doras: well, one issue was introduced by adding tar packages by fossy</span></div><div class="line" id="165520"><span class="nick" style="color:#389600"><a href="#165520" label="[16:55:20]">&lt;stikonas&gt;</a></span><span class="message">since tar was packing them in undefined order (tmpfs vs non-tmpfs)</span></div><div class="line" id="165539"><span class="nick" style="color:#2e2a4a"><a href="#165539" label="[16:55:39]">&lt;doras&gt;</a></span><span class="message">I see...</span></div><div class="line" id="165541"><span class="nick" style="color:#389600"><a href="#165541" label="[16:55:41]">&lt;stikonas&gt;</a></span><span class="message">also we are checksumming more stuff now (basically everything), so maybe some of the issues were present</span></div><div class="line" id="165620"><span class="nick" style="color:#2e2a4a"><a href="#165620" label="[16:56:20]">&lt;doras&gt;</a></span><span class="message">Like additional reproducibility issues.</span></div><div class="line" id="170211"><span class="nick" style="color:#2e2a4a"><a href="#170211" label="[17:02:11]">&lt;doras&gt;</a></span><span class="message">stikonas: is there any chance you could send me your tmp/usr/src/repo/util-linux-2.19.1_0.tar.bz2?</span></div><div class="line" id="170301"><span class="nick" style="color:#2e2a4a"><a href="#170301" label="[17:03:01]">&lt;doras&gt;</a></span><span class="message">I don't have a reference for the file behind the hash we expect.</span></div><div class="line" id="170308"><span class="nick" style="color:#2e2a4a"><a href="#170308" label="[17:03:08]">&lt;doras&gt;</a></span><span class="message">So I can't compare it to anything.</span></div><div class="line" id="170335"><span class="nick" style="color:#389600"><a href="#170335" label="[17:03:35]">&lt;stikonas&gt;</a></span><span class="message"> <a rel="nofollow" href="https://stikonas.eu/files/bootstrap/util-linux-2.19.1_0.tar.bz2">https://stikonas.eu/files/bootstrap/util-linux-2.19.1_0.tar.bz2</a> </span></div><div class="line" id="170455"><span class="nick" style="color:#2e2a4a"><a href="#170455" label="[17:04:55]">&lt;doras&gt;</a></span><span class="message">Thanks!</span></div><div class="line" id="170512"><span class="nick" style="color:#234e69"><a href="#170512" label="[17:05:12]">&lt;rkeene&gt;</a></span><span class="message">FWIW, I use a content-addressable proxy for fetching remote resources since they could disappear.  <a rel="nofollow" href="http://hashcache.rkeene.org/">http://hashcache.rkeene.org/</a> </span></div><div class="line" id="170632"><span class="nick" style="color:#234e69"><a href="#170632" label="[17:06:32]">&lt;rkeene&gt;</a></span><span class="message">Example: <a rel="nofollow" href="https://kitcreator.rkeene.org/fossil/artifact/d546c4b48dfce807">https://kitcreator.rkeene.org/fossil/artifact/d546c4b48dfce807</a> </span></div><div class="line" id="170713"><span class="nick" style="color:#2e2a4a"><a href="#170713" label="[17:07:13]">&lt;doras&gt;</a></span><span class="message">stikonas: looks like I'm getting different file contents :\</span></div><div class="line" id="170750"><span class="nick" style="color:#389600"><a href="#170750" label="[17:07:50]">&lt;stikonas&gt;</a></span><span class="message">hmm</span></div><div class="line" id="170829"><span class="nick" style="color:#2e2a4a"><a href="#170829" label="[17:08:29]">&lt;doras&gt;</a></span><span class="message">In mount/disk related commands: blkid, fdisk, findfs, etc.</span></div><div class="line" id="170854"><span class="nick" style="color:#389600"><a href="#170854" label="[17:08:54]">&lt;stikonas&gt;</a></span><span class="message">remote resources disappearing wouldn't be a disaster since we have a lot of local caches of these tarballs</span></div><div class="line" id="170910"><span class="nick" style="color:#389600"><a href="#170910" label="[17:09:10]">&lt;stikonas&gt;</a></span><span class="message">doras: run diffoscope</span></div><div class="line" id="170935"><span class="nick" style="color:#234e69"><a href="#170935" label="[17:09:35]">&lt;rkeene&gt;</a></span><span class="message">stikonas, A local cache doesn't scale over time</span></div><div class="line" id="170954"><span class="nick" style="color:#389600"><a href="#170954" label="[17:09:54]">&lt;stikonas&gt;</a></span><span class="message">why?</span></div><div class="line" id="171004"><span class="nick" style="color:#234e69"><a href="#171004" label="[17:10:04]">&lt;rkeene&gt;</a></span><span class="message">Because local systems die and are replaced over time</span></div><div class="line" id="171021"><span class="nick" style="color:#389600"><a href="#171021" label="[17:10:21]">&lt;stikonas&gt;</a></span><span class="message">but that's only a problem if remote site dies</span></div><div class="line" id="171025"><span class="nick" style="color:#234e69"><a href="#171025" label="[17:10:25]">&lt;rkeene&gt;</a></span><span class="message">New people join and existing people leave</span></div><div class="line" id="171031"><span class="nick" style="color:#389600"><a href="#171031" label="[17:10:31]">&lt;stikonas&gt;</a></span><span class="message">and we have quite a few people running this</span></div><div class="line" id="171100"><span class="nick" style="color:#234e69"><a href="#171100" label="[17:11:00]">&lt;rkeene&gt;</a></span><span class="message">In other words you have an ad-hoc mesh of files of varying ages and no way to know if anyone has the complete archive</span></div><div class="line" id="171245"><span class="nick" style="color:#389600"><a href="#171245" label="[17:12:45]">&lt;stikonas&gt;</a></span><span class="message">well, strictly speaking yes, but contents don't change often</span></div><div class="line" id="171247"><span class="nick" style="color:#234e69"><a href="#171247" label="[17:12:47]">&lt;rkeene&gt;</a></span><span class="message">There's a reason every project that spans decades has a mechanism for holding a copy of the data they rely on in a remote repository</span></div><div class="line" id="171324"><span class="nick" style="color:#234e69"><a href="#171324" label="[17:13:24]">&lt;rkeene&gt;</a></span><span class="message">stikonas, As far as you know -- although you've just been given an example of it apparently changing :-)</span></div><div class="line" id="171342"><span class="nick" style="color:#389600"><a href="#171342" label="[17:13:42]">&lt;stikonas&gt;</a></span><span class="message">oh but mes is maintained by ourselves</span></div><div class="line" id="171356"><span class="nick" style="color:#389600"><a href="#171356" label="[17:13:56]">&lt;stikonas&gt;</a></span><span class="message">the problem is some historical tarballs disappearing</span></div><div class="line" id="171408"><span class="nick" style="color:#389600"><a href="#171408" label="[17:14:08]">&lt;stikonas&gt;</a></span><span class="message">mes is specifically written with bootstrap in mind</span></div><div class="line" id="171418"><span class="nick" style="color:#389600"><a href="#171418" label="[17:14:18]">&lt;stikonas&gt;</a></span><span class="message">and new releases will not break bootstrappability</span></div><div class="line" id="171446"><span class="nick" style="color:#389600"><a href="#171446" label="[17:14:46]">&lt;stikonas&gt;</a></span><span class="message">the risk is that some other older tarballs would disappear</span></div><div class="line" id="171524"><span class="nick" style="color:#389600"><a href="#171524" label="[17:15:24]">&lt;stikonas&gt;</a></span><span class="message">but most of them are from gnu project with good mirroring</span></div><div class="line" id="171544"><span class="nick" style="color:#234e69"><a href="#171544" label="[17:15:44]">&lt;rkeene&gt;</a></span><span class="message">Or that they will change (which is why it's content addressed)</span></div><div class="line" id="174624"><span class="nick" style="color:#2e2a4a"><a href="#174624" label="[17:46:24]">&lt;doras&gt;</a></span><span class="message">So many changes: <a rel="nofollow" href="https://gitlab.gnome.org/-/snippets/3446/raw/main/blkid.diff">https://gitlab.gnome.org/-/snippets/3446/raw/main/blkid.diff</a> </span></div><div class="line" id="174656"><span class="nick" style="color:#2e2a4a"><a href="#174656" label="[17:46:56]">&lt;doras&gt;</a></span><span class="message">It's most likely a configure thing again.</span></div><div class="line" id="174746"><span class="nick" style="color:#2e2a4a"><a href="#174746" label="[17:47:46]">&lt;doras&gt;</a></span><span class="message">Unless someone can analyze that giant diff into something meaningful, I'll need the build log that ends up with the expected hash.</span></div><div class="line" id="182431"><span class="nick" style="color:#2e2a4a"><a href="#182431" label="[18:24:31]">&lt;doras&gt;</a></span><span class="message">Regardless of util-linux-2.19.1_0.tar.bz2 failing the hash check in the chroot mode, I have perl-5.003_0.tar.bz2 failing the hash diff in my bwrap mode.</span></div><div class="line" id="182455"><span class="nick" style="color:#2e2a4a"><a href="#182455" label="[18:24:55]">&lt;doras&gt;</a></span><span class="message">It's funny (or sad) how all of this worked a few months ago.</span></div><div class="line" id="182548"><span class="nick" style="color:#2e2a4a"><a href="#182548" label="[18:25:48]">&lt;doras&gt;</a></span><span class="message">Regarding the bwrap mode, it seems that the tar contains different file permissions.</span></div><div class="line" id="182627"><span class="nick" style="color:#2e2a4a"><a href="#182627" label="[18:26:27]">&lt;doras&gt;</a></span><span class="message">--rw-r--r-- for the chroot mode, and -rw-rw-r-- for the bwrap mode.</span></div><div class="line" id="182644"><span class="nick" style="color:#2e2a4a"><a href="#182644" label="[18:26:44]">&lt;doras&gt;</a></span><span class="message">Also --rwxr-xr-x vs. -rwxrwxr-x</span></div><div class="line" id="182728"><span class="nick" style="color:#2e2a4a"><a href="#182728" label="[18:27:28]">&lt;doras&gt;</a></span><span class="message">So it seems that the group write bit is set for the chroot mode for whatever reason.</span></div><div class="line" id="182748"><span class="nick" style="color:#2e2a4a"><a href="#182748" label="[18:27:48]">&lt;doras&gt;</a></span><span class="message">This is the linux-util build log: <a rel="nofollow" href="https://gitlab.gnome.org/-/snippets/3447/raw/main/util-linux-2.19.1-build.log">https://gitlab.gnome.org/-/snippets/3447/raw/main/util-linux-2.19.1-build.log</a> </span></div><div class="line" id="182804"><span class="nick" style="color:#2e2a4a"><a href="#182804" label="[18:28:04]">&lt;doras&gt;</a></span><span class="message">I'd be happy if someone could diff it with the working build log.</span></div><div class="line" id="182812"><span class="nick" style="color:#2e2a4a"><a href="#182812" label="[18:28:12]">&lt;doras&gt;</a></span><span class="message">Or share theirs.</span></div><div class="line" id="203557"><span class="nick" style="color:#2e2a4a"><a href="#203557" label="[20:35:57]">&lt;doras&gt;</a></span><span class="message">So basically since we started adding everything to tar archives, file permissions are now also hashed.</span></div><div class="line" id="203858"><span class="nick" style="color:#2e2a4a"><a href="#203858" label="[20:38:58]">&lt;doras&gt;</a></span><span class="message">Which means the umask of the user that executes the bootstrap is part of the hash.</span></div><div class="line" id="203943"><span class="nick" style="color:#2e2a4a"><a href="#203943" label="[20:39:43]">&lt;doras&gt;</a></span><span class="message">This can differ in different systems and environments.</span></div><div class="line" id="204053"><span class="nick" style="color:#2e2a4a"><a href="#204053" label="[20:40:53]">&lt;doras&gt;</a></span><span class="message">Do we know what umask is set for the user in the bare metal bootstrap? Where would this value be coming from in that case?</span></div><div class="line" id="204718"><span class="nick" style="color:#80b1d3"><a href="#204718" label="[20:47:18]">&lt;stikonas[m]&gt;</a></span><span class="message">Hmm, I guess from the kernel</span></div><div class="line" id="205150"><span class="nick" style="color:#80b1d3"><a href="#205150" label="[20:51:50]">&lt;stikonas[m]&gt;</a></span><span class="message">Probably 0022</span></div><div class="line" id="205231"><span class="nick" style="color:#80b1d3"><a href="#205231" label="[20:52:31]">&lt;stikonas[m]&gt;</a></span><span class="message">doras: can you set it in run.sh?</span></div><div class="line" id="205257"><span class="nick" style="color:#2e2a4a"><a href="#205257" label="[20:52:57]">&lt;doras&gt;</a></span><span class="message">I don't have umask when I already fail.</span></div><div class="line" id="205349"><span class="nick" style="color:#2e2a4a"><a href="#205349" label="[20:53:49]">&lt;doras&gt;</a></span><span class="message">The first thing that fails is perl-5.003_0.tar.bz2.</span></div><div class="line" id="205349"><span class="nick" style="color:#2e2a4a"><a href="#205349" label="[20:53:49]">&lt;doras&gt;</a></span><span class="message">And in that point we don't have the umask command yet.</span></div><div class="line" id="205511"><span class="nick" style="color:#2e2a4a"><a href="#205511" label="[20:55:11]">&lt;doras&gt;</a></span><span class="message">Which is odd.</span></div><div class="line" id="205535"><span class="nick" style="color:#2e2a4a"><a href="#205535" label="[20:55:35]">&lt;doras&gt;</a></span><span class="message">The &quot;umask&quot; command comes from the bash package in my Fedora system.</span></div><div class="line" id="205542"><span class="nick" style="color:#2e2a4a"><a href="#205542" label="[20:55:42]">&lt;doras&gt;</a></span><span class="message">... which is also odd.</span></div><div class="line" id="210059"><span class="nick" style="color:#234e69"><a href="#210059" label="[21:00:59]">&lt;rkeene&gt;</a></span><span class="message">I use &quot;tardy&quot; to post-process my own tarballs (though I tend to use cpio archives for this)</span></div><div class="line" id="210245"><span class="nick" style="color:#2e2a4a"><a href="#210245" label="[21:02:45]">&lt;doras&gt;</a></span><span class="message">Also, it seems that the default umask is indeed 0022: <a rel="nofollow" href="https://gitlab.com/linux-kernel/stable/-/blob/v4.9.10/fs/fs_struct.c#L165">https://gitlab.com/linux-kernel/stable/-/blob/v4.9.10/fs/fs_struct.c#L165</a> </span></div><div class="line" id="210746"><span class="nick" style="color:#2e2a4a"><a href="#210746" label="[21:07:46]">&lt;doras&gt;</a></span><span class="message">Oh, it's possible that umask is actually a built-in. This is good.</span></div><div class="line" id="210835"><span class="nick" style="color:#234e69"><a href="#210835" label="[21:08:35]">&lt;rkeene&gt;</a></span><span class="message">doras, umask has to be built-in (like cd) because it affects the process attributes</span></div><div class="line" id="211608"><span class="nick" style="color:#2e2a4a"><a href="#211608" label="[21:16:08]">&lt;doras&gt;</a></span><span class="message">I guess so.</span></div><div class="line" id="212224"><span class="nick" style="color:#6c3d55"><a href="#212224" label="[21:22:24]">&lt;vagrantc&gt;</a></span><span class="message">are you talking about the mode of the tarball, or the mode of files inside the tarball?</span></div><div class="line" id="212423"><span class="nick" style="color:#6c3d55"><a href="#212423" label="[21:24:23]">&lt;vagrantc&gt;</a></span><span class="message">if the latter you can typically pass arguments to tar to fix that (e.g. --numeric-owner --owner=0 --group=0 --mode=go=rX,u+rw,a-s) <a rel="nofollow" href="https://reproducible-builds.org/docs/archives/">https://reproducible-builds.org/docs/archives/</a> </span></div><div class="line" id="212440"><span class="nick" style="color:#6c3d55"><a href="#212440" label="[21:24:40]">&lt;vagrantc&gt;</a></span><span class="message">that reminds me, i should add --mode in there...</span></div><div class="line" id="212826"><span class="nick" style="color:#80b1d3"><a href="#212826" label="[21:28:26]">&lt;stikonas[m]&gt;</a></span><span class="message">umask wouldn't work</span></div><div class="line" id="212907"><span class="nick" style="color:#80b1d3"><a href="#212907" label="[21:29:07]">&lt;stikonas[m]&gt;</a></span><span class="message"> <a rel="nofollow" href="https://git.savannah.gnu.org/cgit/mes.git/tree/lib/stub/umask.c#n25">https://git.savannah.gnu.org/cgit/mes.git/tree/lib/stub/umask.c#n25</a> </span></div><div class="line" id="213555"><span class="nick" style="color:#80b1d3"><a href="#213555" label="[21:35:55]">&lt;stikonas[m]&gt;</a></span><span class="message">but I think -numeric-owner --owner=0 --group=0 --mode=go=rX,u+rw,a-s would work, it seems to be available in tar 1.12</span></div><div class="line" id="213802"><span class="nick" style="color:#2e2a4a"><a href="#213802" label="[21:38:02]">&lt;doras&gt;</a></span><span class="message">stikonas: indeed it doesn't :(</span></div><div class="line" id="213825"><span class="nick" style="color:#80b1d3"><a href="#213825" label="[21:38:25]">&lt;stikonas[m]&gt;</a></span><span class="message">well, it's just a stub in meslibc</span></div><div class="line" id="213845"><span class="nick" style="color:#389600"><a href="#213845" label="[21:38:45]">&lt;stikonas&gt;</a></span><span class="message">try changing tar arguments instead</span></div><div class="line" id="213933"><span class="nick" style="color:#2e2a4a"><a href="#213933" label="[21:39:33]">&lt;doras&gt;</a></span><span class="message">Sounds like something that may break many hashes</span></div><div class="line" id="213941"><span class="nick" style="color:#2e2a4a"><a href="#213941" label="[21:39:41]">&lt;doras&gt;</a></span><span class="message">Well, change.</span></div><div class="line" id="213944"><span class="nick" style="color:#2e2a4a"><a href="#213944" label="[21:39:44]">&lt;doras&gt;</a></span><span class="message">I'll try</span></div><div class="line" id="214502"><span class="nick" style="color:#2e2a4a"><a href="#214502" label="[21:45:02]">&lt;doras&gt;</a></span><span class="message">But since I still don't trust the hashes I get in my system (I haven't managed to reach a full bootstrap yet), if it does change the hashes, I'll need someone that can complete the bootstrap to update them.</span></div><div class="line" id="214549"><span class="nick" style="color:#389600"><a href="#214549" label="[21:45:49]">&lt;stikonas&gt;</a></span><span class="message">doras: can't you run it in qemu?</span></div><div class="line" id="214611"><span class="nick" style="color:#2e2a4a"><a href="#214611" label="[21:46:11]">&lt;doras&gt;</a></span><span class="message">I never tried qemu. I can try.</span></div><div class="line" id="214633"><span class="nick" style="color:#389600"><a href="#214633" label="[21:46:33]">&lt;stikonas&gt;</a></span><span class="message">well, try, it would be easier for you to develop if you have trusted state (hashes, logs, etc)</span></div><div class="line" id="214903"><span class="nick" style="color:#2e2a4a"><a href="#214903" label="[21:49:03]">&lt;doras&gt;</a></span><span class="message">What's the actual procedure to use qemu for the bootstrap?</span></div><div class="line" id="215001"><span class="nick" style="color:#2e2a4a"><a href="#215001" label="[21:50:01]">&lt;doras&gt;</a></span><span class="message">Because I'm getting &quot;mkfs.ext4: No such file or directory while trying to determine filesystem size&quot; when running &quot;./rootfs.py --qemu&quot;</span></div><div class="line" id="215041"><span class="nick" style="color:#389600"><a href="#215041" label="[21:50:41]">&lt;stikonas&gt;</a></span><span class="message">./roootfs -q -qk ${KERNEL}</span></div><div class="line" id="215041"><span class="nick" style="color:#2e2a4a"><a href="#215041" label="[21:50:41]">&lt;doras&gt;</a></span><span class="message">Hmmm...</span></div><div class="line" id="215047"><span class="nick" style="color:#389600"><a href="#215047" label="[21:50:47]">&lt;stikonas&gt;</a></span><span class="message">${KERNEL} should point to 32-bit kernel</span></div><div class="line" id="215129"><span class="nick" style="color:#2e2a4a"><a href="#215129" label="[21:51:29]">&lt;doras&gt;</a></span><span class="message">Tricky.</span></div><div class="line" id="215150"><span class="nick" style="color:#2e2a4a"><a href="#215150" label="[21:51:50]">&lt;doras&gt;</a></span><span class="message">Where does one obtain a 32-bit kernel these days? :D</span></div><div class="line" id="215209"><span class="nick" style="color:#389600"><a href="#215209" label="[21:52:09]">&lt;stikonas&gt;</a></span><span class="message">build it?</span></div><div class="line" id="215228"><span class="nick" style="color:#6c3d55"><a href="#215228" label="[21:52:28]">&lt;vagrantc&gt;</a></span><span class="message">debian still ships at least one 32-bit x86 kernel</span></div><div class="line" id="215233"><span class="nick" style="color:#6c3d55"><a href="#215233" label="[21:52:33]">&lt;vagrantc&gt;</a></span><span class="message">guix too, i think</span></div><div class="line" id="215238"><span class="nick" style="color:#389600"><a href="#215238" label="[21:52:38]">&lt;stikonas&gt;</a></span><span class="message">I just ran make ARCH=i386</span></div><div class="line" id="222443"><span class="nick" style="color:#2e2a4a"><a href="#222443" label="[22:24:43]">&lt;doras&gt;</a></span><span class="message">stikonas: thanks for the tip.</span></div><div class="line" id="222528"><span class="nick" style="color:#2e2a4a"><a href="#222528" label="[22:25:28]">&lt;doras&gt;</a></span><span class="message">Any special drivers needed, or does the i386 defconfig good enough?</span></div><div class="line" id="222536"><span class="nick" style="color:#2e2a4a"><a href="#222536" label="[22:25:36]">&lt;doras&gt;</a></span><span class="message">or is*</span></div><div class="line" id="222549"><span class="nick" style="color:#389600"><a href="#222549" label="[22:25:49]">&lt;stikonas&gt;</a></span><span class="message">almost nothing is necessary</span></div><div class="line" id="222552"><span class="nick" style="color:#389600"><a href="#222552" label="[22:25:52]">&lt;stikonas&gt;</a></span><span class="message">defconfig is good enough</span></div><div class="line" id="222611"><span class="nick" style="color:#2e2a4a"><a href="#222611" label="[22:26:11]">&lt;doras&gt;</a></span><span class="message">Great.</span></div><div class="line" id="222615"><span class="nick" style="color:#389600"><a href="#222615" label="[22:26:15]">&lt;stikonas&gt;</a></span><span class="message">there are a few things that are needed on top of allnoconfig but pretty much everything would work</span></div><div class="line" id="232015"><span class="nick" style="color:#d9d9d9"><a href="#232015" label="[23:20:15]">&lt;markjenkinssksp&gt;</a></span><span class="message">Regarding the current bootstrappable mailing list thread, and the point re common objection &quot;you’re building from source but you’re not gonna audit all that source code anyway, so why bother?&quot;</span></div><div class="line" id="232036"><span class="nick" style="color:#d9d9d9"><a href="#232036" label="[23:20:36]">&lt;markjenkinssksp&gt;</a></span><span class="message">It's also worth always going back to the conclusions of <a rel="nofollow" href="https://dwheeler.com/trusting-trust/">https://dwheeler.com/trusting-trust/</a>  . We can make inferences about the behavior of the source code of a large program like GCC through a combination of bootstrapping and diverse double-compiling.</span></div><div class="line" id="232121"><span class="nick" style="color:#234e69"><a href="#232121" label="[23:21:21]">&lt;rkeene&gt;</a></span><span class="message">I do bootstrapping to be able to support really long life software projects, since I need to be able to create binary patches for 10+ years</span></div><div class="line" id="232326"><span class="nick" style="color:#d9d9d9"><a href="#232326" label="[23:23:26]">&lt;markjenkinssksp&gt;</a></span><span class="message">If for example we someday bootstrap clang/LLVM to self-hosting without GCC and we're getting the same result as bootstrapping clang/LLVM with gcc, then we can assume the GCC source is okay and doesn't contain a &quot;do the malicious thing if I'm not compiling clang/LLVM&quot;</span></div><div class="line" id="232510"><span class="nick" style="color:#d9d9d9"><a href="#232510" label="[23:25:10]">&lt;markjenkinssksp&gt;</a></span><span class="message">and so audit full source of a shorter bootstrap does allow inferences about the source of larger build tools used in alernative bootstraps</span></div><div class="line" id="232733"><span class="nick" style="color:#bc80bd"><a href="#232733" label="[23:27:33]">&lt;oriansj&gt;</a></span><span class="message">markjenkinssksp: I honestly don't get how someone could say you're not gonna audit all that source code when everything needed fits on 171 pages (single sided size 12 font)</span></div><div class="line" id="232851"><span class="nick" style="color:#bc80bd"><a href="#232851" label="[23:28:51]">&lt;oriansj&gt;</a></span><span class="message">after that you have sha256sum, ungz and untar. Which means collective audits become possible for every single step after that</span></div><div class="line" id="233219"><span class="nick" style="color:#d9d9d9"><a href="#233219" label="[23:32:19]">&lt;markjenkinssksp&gt;</a></span><span class="message">exactly oriansj, audit the short stuff, don't worry about auditing the gcc source.</span></div><div class="line" id="233315"><span class="nick" style="color:#d9d9d9"><a href="#233315" label="[23:33:15]">&lt;markjenkinssksp&gt;</a></span><span class="message">perhaps we'll even have video lectures walking through all the short stuff some day...</span></div><div class="line" id="233528"><span class="nick" style="color:#d9d9d9"><a href="#233528" label="[23:35:28]">&lt;markjenkinssksp&gt;</a></span><span class="message">People might also respect the auditability of the short stuff more some day if we have it buyable in print as a way to support these efforts</span></div><div class="line" id="233542"><span class="nick" style="color:#bc80bd"><a href="#233542" label="[23:35:42]">&lt;oriansj&gt;</a></span><span class="message">well audit *all* of the things but do it in a fashion that allows multiple independent parties to attest their audits and allow reputation to be known</span></div><div class="line" id="233620"><span class="nick" style="color:#bc80bd"><a href="#233620" label="[23:36:20]">&lt;oriansj&gt;</a></span><span class="message">well I guess I could do a book on bootstrapping that covers all of the source and everything one would need to audit it</span></div><div class="line" id="233704"><span class="nick" style="color:#d9d9d9"><a href="#233704" label="[23:37:04]">&lt;markjenkinssksp&gt;</a></span><span class="message">exactly, let the gcc devs audit GCC, let the Linux devs audit Linux, let the bootstrappable.org community audit the bootstraps, and draw additional conclusions about the behavior of big programs like Linux, gcc, clang/llvm by way of DDC</span></div><div class="line" id="233727"><span class="nick" style="color:#bc80bd"><a href="#233727" label="[23:37:27]">&lt;oriansj&gt;</a></span><span class="message">but that would take a couple months of work</span></div><div class="line" id="233800"><span class="nick" style="color:#bc80bd"><a href="#233800" label="[23:38:00]">&lt;oriansj&gt;</a></span><span class="message">hmmm.</span></div><div class="line" id="233844"><span class="nick" style="color:#d9d9d9"><a href="#233844" label="[23:38:44]">&lt;markjenkinssksp&gt;</a></span><span class="message">I'm assuming there will be another kernel available for bootstrap purposes at some point as well that will help make DDC conclusions about the behavior of Linux when its running dev tools</span></div><div class="line" id="233934"><span class="nick" style="color:#d9d9d9"><a href="#233934" label="[23:39:34]">&lt;markjenkinssksp&gt;</a></span><span class="message">or similar conclusions if the same set of audited software is used to bootstrap GNU/Linux on one side, FreeBSD on the other side</span></div><div class="line" id="234011"><span class="nick" style="color:#bc80bd"><a href="#234011" label="[23:40:11]">&lt;oriansj&gt;</a></span><span class="message">markjenkinssksp: well yes that is the plan</span></div><div class="line" id="234033"><span class="nick" style="color:#bc80bd"><a href="#234033" label="[23:40:33]">&lt;oriansj&gt;</a></span><span class="message">getting there however is going to be a bit of a minor mountain to climb</span></div><div class="line" id="234318"><span class="nick" style="color:#bc80bd"><a href="#234318" label="[23:43:18]">&lt;oriansj&gt;</a></span><span class="message">my plan was get a rough but usable kernel written in C and then just manually write it in M1/gas assembly.</span></div><div class="line" id="234441"><span class="nick" style="color:#bc80bd"><a href="#234441" label="[23:44:41]">&lt;oriansj&gt;</a></span><span class="message">as I am giving up on the idea of doing a kernel written in the M2-Planet C subset as I have come to realize that hardware is less forgiving to missing C features than a POSIX is</span></div><div class="line" id="234556"><span class="nick" style="color:#d9d9d9"><a href="#234556" label="[23:45:56]">&lt;markjenkinssksp&gt;</a></span><span class="message">I'm kind of interested in seeing if Bellard's tccboot is reviable and then it plus a initrd buildable in a simpler non-kernel environment, though I recognize that even with a full environment to run mescc to build tccboot, there would be real c compiler work to get tccboot and mescc compatible</span></div><div class="line" id="234637"><span class="nick" style="color:#d9d9d9"><a href="#234637" label="[23:46:37]">&lt;markjenkinssksp&gt;</a></span><span class="message">I also have hardware that's compatible with the drivers available in the version of Linux that tccboot could build and boot, so at least I personally need to do any driver dev for this particular shower throught</span></div><div class="line" id="234728"><span class="nick" style="color:#bc80bd"><a href="#234728" label="[23:47:28]">&lt;oriansj&gt;</a></span><span class="message">well <a rel="nofollow" href="https://github.com/vvaltchev/tilck">https://github.com/vvaltchev/tilck</a>  and xv6 might be possible paths forward for building GCC+Linux+Guile</span></div><div class="line" id="234901"><span class="nick" style="color:#bc80bd"><a href="#234901" label="[23:49:01]">&lt;oriansj&gt;</a></span><span class="message">but testing needs to be done to find viable kernels to run live-bootstrap on</span></div><div class="line" id="234921"><span class="nick" style="color:#d9d9d9"><a href="#234921" label="[23:49:21]">&lt;markjenkinssksp&gt;</a></span><span class="message">interesting, if one could do the work to get tccboot to build tilck in addition to the old patched linux that tccboot could build, then two diverse kernels could be bootstapped to run live-bootstrap independently</span></div><div class="line" id="235129"><span class="nick" style="color:#bc80bd"><a href="#235129" label="[23:51:29]">&lt;oriansj&gt;</a></span><span class="message">well the smaller and simpler the root POSIX is, the easier it will be to audit the hand written assembly version of it will be</span></div><div class="line" id="235319"><span class="nick" style="color:#d9d9d9"><a href="#235319" label="[23:53:19]">&lt;markjenkinssksp&gt;</a></span><span class="message">oh, sure enough, vvaltchev has discussed with folks the prospect of building tilck with TCC <a rel="nofollow" href="https://github.com/vvaltchev/tilck/discussions/93">https://github.com/vvaltchev/tilck/discussions/93</a> </span></div><div class="line" id="235532"><span class="nick" style="color:#bc80bd"><a href="#235532" label="[23:55:32]">&lt;oriansj&gt;</a></span><span class="message">*sigh* kernel is going to be the next major bootstrapping fight</span></div><div class="line" id="235549"><span class="nick" style="color:#bc80bd"><a href="#235549" label="[23:55:49]">&lt;oriansj&gt;</a></span><span class="message">and it is going to be much harder than the bootstrap from hex to GCC fight</span></div><div class="line" id="235848"><span class="nick" style="color:#389600"><a href="#235848" label="[23:58:48]">&lt;stikonas&gt;</a></span><span class="message">no doubt about that...</span></div><br /></div></body></html>